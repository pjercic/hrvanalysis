'''
Created on Dec 5, 2019

@author: petar
'''

from typing import List
from hrvanalysis import remove_outliers, remove_ectopic_beats, interpolate_nan_values, get_jamzone_time_domain_features
    
def transform_to_rmssd_statistics(rr_list: List[float]) -> dict:
    
    #Remove the outliers in the signal
    rr_intervals_without_outliers = remove_outliers(rr_intervals=rr_list, low_rri=300, high_rri=3000)
    
    # This replace outliers nan values with linear interpolation
    interpolated_rr_intervals = interpolate_nan_values(rr_intervals=rr_intervals_without_outliers, interpolation_method="linear")
    
    # This remove ectopic beats from signal
    nn_intervals_list = remove_ectopic_beats(rr_intervals=interpolated_rr_intervals, method="malik")
    
    # This replace ectopic beats nan values with linear interpolation
    interpolated_nn_intervals = interpolate_nan_values(rr_intervals=nn_intervals_list)
    
    # Get time-domain and frequency domain features from our signal
    time_domain_features = get_jamzone_time_domain_features(interpolated_nn_intervals)
  
    return time_domain_features
  
def test_transform_to_rmssd_statistics():
    
    # rr_intervals_list contains integer values of RR-interval
    rr_test_intervals = [1575, 1591, 1594, 1594, 1609, 1625, 1630, 1628, 1634, 1637, 1652, 1667, 1667, 1691, 1700, 1685, 1670, 1667, 1667, 1667, 1682, 1679, 1667, 1676, 1682, 1682, 1685, 1700, 1679, 1700, 1703, 1703, 1703, 1703, 1712, 1720, 1720, 1720, 1723, 1735, 1735, 1735, 1748, 1748, 1755, 1755, 1761, 1766, 1764, 1757, 1757, 1764, 1764, 1766, 1769, 1761, 1761, 1761, 1761, 1755, 1757, 1761, 1761, 1764, 1778, 1766, 1775, 1780, 1780, 1775, 1778, 1780, 1786, 1817, 1817, 1800, 1800, 1803, 1803, 1814, 1814, 1822, 1822, 1825, 1830, 1864, 1871, 1871, 1887, 1887, 1887, 1895, 1895, 1895, 1892, 1895, 1913, 1918, 1918, 1921, 1907, 1910, 1913, 1913, 1855, 1855, 1857, 1855, 1855, 1855, 1848, 1855, 1864, 1863, 1868, 1868, 1868, 1871, 1871, 1871, 1873, 1873, 1871, 1879, 1879, 1879, 1880, 1884, 1892, 1889, 1892, 1892, 1900, 1903, 1900, 1900, 1903, 1897, 1897, 1895, 1889, 1884, 1871, 1864, 1864, 1871, 1857, 1857, 1757, 1755, 1757, 1757, 1757, 1748, 1738, 1744, 1744, 1746, 1746, 1752, 1752, 1744, 1741, 1741, 1741, 1741, 1741, 1746, 1746, 1741, 1738, 1738, 1738, 1744, 1746, 1746, 1738, 1729, 1735, 1735, 1748, 1766, 1755, 1755, 1757, 1744, 1726, 1723, 1723, 1718, 1700, 1685, 1676, 1648, 1639, 1643, 1646, 1646, 1652, 1652, 1634, 1637, 1634, 1628, 1634, 1634, 1616, 1612, 1591, 1591, 1587, 1591, 1594, 1587, 1578, 1575, 1578, 1572, 1572, 1575, 1559, 1575, 1575, 1584, 1575, 1572, 1581, 1609, 1609, 1625, 1622, 1612, 1619, 1625, 1622, 1622, 1630, 1628, 1639, 1648, 1634, 1634, 1628, 1619, 1619, 1628, 1625, 1625, 1587, 1584, 1587, 1584, 1587, 1572, 1572, 1562, 1559, 1552, 1513, 1503, 1503, 1483, 1493, 1493, 1487, 1487, 1530, 1536, 1513, 1513, 1526, 1526, 1526, 1738, 1755, 1780, 1780, 1772, 1772, 1772, 1772, 1772, 1772, 1755, 1755, 1755, 1755, 1755, 1752, 1748, 1748, 1748, 1752, 1752, 1746, 1746, 1748, 1741, 1732, 1732, 1729, 1732, 1714, 1726, 1726, 1726, 1729, 1729, 1729, 1729, 1729, 1729, 1772, 1769, 1769, 1766, 1775, 1789, 1789, 1789, 1789, 1789, 1794, 1803, 1825, 1830, 1828, 1836, 1830, 1836, 1836, 1852, 1852, 1855, 1857, 1864, 1871, 1873, 1873, 1873, 1884, 1880, 1887, 1871, 1871, 1855, 1844, 1844, 1864, 1844, 1838, 1848, 1847, 1844, 1844, 1857, 1863, 1863, 1852, 1876, 1876, 1876, 1876, 1880, 1880, 1895, 1889, 1897, 1897, 1895, 1907, 1905, 1910, 1913, 1916, 1923, 1907, 1907, 1913, 1921, 1921, 1921, 1916, 1916, 1921, 1918, 1913, 1916, 1926, 1930, 1921, 1977, 1967, 1972, 1980, 1977, 1952, 1952, 1929, 1936, 1942, 1930, 1930, 1936, 1936, 1942, 1944, 1929, 1926, 1929, 1929, 1930, 2005, 2010, 2010, 2002, 2002, 1995, 1992, 1992, 1989, 1989, 1997, 2002, 2005, 2014, 2022, 2022, 2022, 2027, 2030, 2032, 2027, 2020, 2032, 2030, 2030, 2002, 1997, 1997, 1982, 1987, 1982, 1792, 1766, 1741, 1741, 1741, 1746, 1748, 1748, 1748, 1748, 1752, 1772, 1775, 1775, 1775, 1775, 1778, 1772, 1778, 1772, 1772, 1772, 1769, 1766, 1766, 1769, 1775, 1780, 1782, 1782, 1778, 1780, 1772, 1775, 1786, 1786, 1786, 1792, 1786, 1825, 1847, 1805, 1811, 1817, 1814, 1805, 1805, 1805, 1805, 1805, 1803, 1797, 1775, 1772, 1764, 1764, 1761, 1755, 1755, 1757, 1761, 1746, 1746, 1772, 1775, 1766, 1766, 1811, 1817, 1817, 1830, 1864, 1895, 1876, 1987, 1985, 1972, 1970, 1977, 1980, 1975, 1975, 1975, 1975, 1952, 1967, 1967, 1967, 1967, 1960, 1957, 1947, 1942, 1939, 1939, 1947, 1930, 1930, 1918, 1916, 1913, 1900, 1900, 1897, 1897, 1889, 1889, 1884, 1889, 1892, 1889, 1892, 1892, 1897, 1889, 1892, 1884, 1838, 1876, 1892, 1926, 1944, 1942, 1942, 1934, 1930, 1930, 1930, 1936, 1936, 1918, 1926, 1926, 1926, 1939, 1934, 1857, 1857, 1860, 1954, 2025, 2025, 2025, 2027, 2027, 2027, 2022, 2022, 2017, 2010, 2002, 2002, 2012, 2010, 2005, 2007, 2010, 2010, 2010, 1995, 1995, 1997, 1992, 1989, 1989, 1989, 1987, 2000, 2005, 2007, 2014, 2012, 2035, 2042, 2035, 2037, 2045, 2045, 2042, 2027, 2027, 2027, 2049, 2049, 2049, 2057, 2057, 2071, 2076, 2117, 2124, 2145, 2138, 2135, 2133, 2131, 2131, 2135, 2135, 2131, 2131, 2131, 2145, 2147, 2145, 2145, 2114, 2100, 2098, 2093, 2088, 2088, 2102, 2088, 2088, 2088, 2086, 2086, 2081, 2078, 2088, 2093, 2093, 2093, 2095, 2093, 2098, 2095, 2093, 2093, 2100, 2098, 2076, 2076, 2076, 2076, 2035, 2035, 2017, 1985, 1944, 1832, 1830, 1832, 1828, 1825, 1880, 1873, 1871, 1876, 1887, 1930, 1930, 1930, 1930, 1929, 1944, 1944, 1944, 1952, 1954, 1962, 1952, 1952, 1957, 1952, 1957, 1957, 1962, 1970, 1972, 1972, 1982, 2025, 2035, 2042, 2047, 2049, 2049, 2047, 2047, 2042, 2035, 2027, 2025, 2025, 2010, 2017, 1980, 1962, 1934, 1910, 1910, 1918, 1923, 1929, 1930, 1923, 1916, 1916, 1913, 1918, 1907, 1907, 1905, 1897, 1897, 1897, 1884, 1880, 1786, 1705, 1714, 1718, 1712, 1712, 1720, 1720, 1712, 1714, 1714, 1714, 1714, 1697, 1703, 1703, 1714, 1712, 1712, 1712, 1714, 1714, 1714, 1714, 1723, 1718, 1718, 1718, 1714, 1700, 1700, 1691, 1691, 1667, 1655, 1661, 1661, 1652, 1655, 1655, 1694, 1694, 1694, 1667, 1667, 1667, 1673, 1673, 1657, 1648, 1597, 1581, 1591, 1591, 1616, 1616, 1622, 1657, 1673, 1673, 1670, 1667, 1646, 1643, 1643, 1643, 1643, 1637, 1646, 1661, 1661, 1661, 1648, 1655, 1655, 1657, 1673, 1712, 1720, 1723, 1718, 1709, 1709, 1712, 1709, 1712, 1709, 1705, 1697, 1694, 1709, 1700, 1700, 1697, 1694, 1694, 1694, 1694, 1694, 1694, 1694, 1694, 1694, 1694, 1694, 1697, 1700, 1703, 1700, 1637, 1637, 1639, 1630, 1622, 1568, 1556, 1556, 1556, 1559, 1546, 1549, 1552, 1543, 1536, 1539, 1536, 1546, 1546, 1543, 1549, 1549, 1546, 1546, 1549, 1536, 1483, 1466, 1459, 1453, 1456, 1459, 1463, 1466, 1466, 1470, 1473, 1476, 1480, 1483, 1476, 1476, 1470, 1470, 1466, 1473, 1476, 1470, 1463, 1466, 1473, 1476, 1480, 1487, 1490, 1490, 1497, 1500, 1507, 1497, 1503, 1507, 1513, 1517, 1523, 1526, 1533, 1523, 1526, 1533, 1539, 1533, 1536, 1539, 1543, 1546, 1552, 1559, 1565, 1562, 1572, 1549, 1556, 1562, 1565, 1565, 1572, 1578, 1581, 1575, 1581, 1587, 1594, 1600, 1609, 1612, 1622, 1630, 1630, 1637, 1643, 1643, 1648, 1648, 1657, 1594, 1594, 1603, 1612]

    time_domain_features = transform_to_rmssd_statistics(rr_test_intervals)
    
    print(time_domain_features)
    